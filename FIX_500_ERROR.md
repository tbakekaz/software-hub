# ä¿®å¤ 500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ - å®Œæ•´æŒ‡å—

## é—®é¢˜è¯´æ˜

500 é”™è¯¯è¡¨ç¤ºæœåŠ¡å™¨åœ¨å¤„ç†è¯·æ±‚æ—¶é‡åˆ°äº†å†…éƒ¨é”™è¯¯ã€‚å¯¹äº Cloudflare Pages + Next.js Edge Runtimeï¼Œå¸¸è§åŸå› åŒ…æ‹¬ï¼š

1. **æ¨¡å—å¯¼å…¥é—®é¢˜**ï¼š`require()` åœ¨ Edge Runtime ä¸­å¯èƒ½ä¸å¯ç”¨
2. **å†…å®¹æ–‡ä»¶æœªç”Ÿæˆ**ï¼š`lib/generated/content.ts` åœ¨æ„å»ºæ—¶æœªæ­£ç¡®ç”Ÿæˆ
3. **å…¼å®¹æ€§æ ‡å¿—æœªå¯ç”¨**ï¼š`nodejs_compat` æ ‡å¿—æœªåœ¨ Cloudflare Dashboard ä¸­å¯ç”¨

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. ä¿®å¤æ¨¡å—å¯¼å…¥æ–¹å¼

**é—®é¢˜**ï¼š`lib/content-edge.ts` ä½¿ç”¨ `require()` å¯¼å…¥ç”Ÿæˆçš„å†…å®¹ï¼Œè¿™åœ¨ Edge Runtime ä¸­å¯èƒ½ä¸å¯ç”¨ã€‚

**ä¿®å¤**ï¼šæ”¹ä¸ºä½¿ç”¨ ES6 é™æ€ `import`ï¼Œåœ¨æ„å»ºæ—¶è§£æï¼š

```typescript
// ä¹‹å‰ï¼ˆå¯èƒ½æœ‰é—®é¢˜ï¼‰
const generated = require('./generated/content');

// ç°åœ¨ï¼ˆæ­£ç¡®ï¼‰
import * as generated from './generated/content';
```

### 2. ç¡®ä¿å†…å®¹æ–‡ä»¶ç”Ÿæˆ

`prebuild` è„šæœ¬ä¼šåœ¨æ„å»ºå‰è‡ªåŠ¨ç”Ÿæˆ `lib/generated/content.ts`ã€‚

### 3. é…ç½®æ–‡ä»¶å·²æ›´æ–°

- `wrangler.toml` - åŒ…å« `nodejs_compat` æ ‡å¿—
- `.cloudflare/pages.json` - Cloudflare Pages é…ç½®

## ğŸ”§ åœ¨ Cloudflare Dashboard ä¸­éœ€è¦åšçš„æ“ä½œ

### æ­¥éª¤ 1ï¼šå¯ç”¨ nodejs_compat æ ‡å¿—ï¼ˆå…³é”®ï¼ï¼‰

1. è®¿é—®ï¼šhttps://dash.cloudflare.com
2. è¿›å…¥ï¼š**Workers å’Œ Pages** â†’ **software-hub** â†’ **è®¾ç½®**ï¼ˆSettingsï¼‰
3. æ‰¾åˆ° **"Functions"** æˆ– **"å…¼å®¹æ€§æ ‡å¿—"** éƒ¨åˆ†
4. ä¸º **ç”Ÿäº§ç¯å¢ƒ** å’Œ **é¢„è§ˆç¯å¢ƒ** éƒ½æ·»åŠ  `nodejs_compat` æ ‡å¿—
5. ä¿å­˜

### æ­¥éª¤ 2ï¼šè§¦å‘é‡æ–°éƒ¨ç½²

1. è¿›å…¥ **"éƒ¨ç½²"**ï¼ˆDeploymentsï¼‰æ ‡ç­¾
2. ç‚¹å‡» **"é‡æ–°éƒ¨ç½²"**ï¼ˆRetry deploymentï¼‰
3. ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆ5-10 åˆ†é’Ÿï¼‰

## ğŸ” éªŒè¯ä¿®å¤

éƒ¨ç½²å®Œæˆåï¼š

1. âœ… è®¿é—® https://software-hub.pages.dev
2. âœ… åº”è¯¥ä¸å†æ˜¾ç¤º 500 é”™è¯¯
3. âœ… ç½‘ç«™æ­£å¸¸åŠ è½½å’Œæ˜¾ç¤ºå†…å®¹

## ğŸ“‹ å¦‚æœä»ç„¶æœ‰é—®é¢˜

### æ£€æŸ¥éƒ¨ç½²æ—¥å¿—

1. åœ¨ Cloudflare Pages çš„ **"éƒ¨ç½²"** æ ‡ç­¾æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
2. æŸ¥æ‰¾ä»»ä½•é”™è¯¯ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯ï¼š
   - æ¨¡å—å¯¼å…¥é”™è¯¯
   - æ–‡ä»¶æœªæ‰¾åˆ°é”™è¯¯
   - è¿è¡Œæ—¶é”™è¯¯

### æ£€æŸ¥æ„å»ºé…ç½®

ç¡®ä¿æ„å»ºå‘½ä»¤æ­£ç¡®ï¼š
```bash
npm install && npm run build && npm run pages:build
```

ç¡®ä¿ `prebuild` è„šæœ¬åœ¨ `build` ä¹‹å‰è¿è¡Œï¼ˆå·²åœ¨ `package.json` ä¸­é…ç½®ï¼‰ã€‚

### æ¸…é™¤ç¼“å­˜

1. åœ¨ Cloudflare Dashboard â†’ **"ç¼“å­˜"**ï¼ˆCachingï¼‰â†’ **"æ¸…é™¤ç¼“å­˜"**ï¼ˆPurge Everythingï¼‰
2. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ï¼š`Cmd+Shift+R`ï¼ˆMacï¼‰æˆ– `Ctrl+Shift+R`ï¼ˆWindowsï¼‰

## ğŸš€ æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆä½¿ç”¨é™æ€ importï¼Ÿ

- **æ„å»ºæ—¶è§£æ**ï¼šé™æ€ `import` åœ¨æ„å»ºæ—¶è§£æï¼Œç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½è¢«æ­£ç¡®æ‰“åŒ…
- **Edge Runtime å…¼å®¹**ï¼šES6 æ¨¡å—åœ¨ Edge Runtime ä¸­å®Œå…¨æ”¯æŒ
- **ç±»å‹å®‰å…¨**ï¼šTypeScript å¯ä»¥æ­£ç¡®æ£€æŸ¥ç±»å‹

### ä¸ºä»€ä¹ˆ require() å¯èƒ½å¤±è´¥ï¼Ÿ

- Edge Runtime åŸºäº Web æ ‡å‡†ï¼Œä¸å®Œå…¨æ”¯æŒ Node.js çš„ `require()`
- å³ä½¿æœ‰ `nodejs_compat` æ ‡å¿—ï¼ŒæŸäº› Node.js API ä»å¯èƒ½ä¸å¯ç”¨
- ES6 æ¨¡å—æ˜¯æ›´å¯é çš„é€‰æ‹©

## âœ… ä¿®å¤æ£€æŸ¥æ¸…å•

- [x] `lib/content-edge.ts` ä½¿ç”¨é™æ€ `import` è€Œä¸æ˜¯ `require()`
- [x] `prebuild` è„šæœ¬æ­£ç¡®é…ç½®
- [x] `wrangler.toml` åŒ…å« `nodejs_compat` æ ‡å¿—
- [ ] åœ¨ Cloudflare Dashboard ä¸­å¯ç”¨äº† `nodejs_compat` æ ‡å¿—ï¼ˆéœ€è¦æ‰‹åŠ¨æ“ä½œï¼‰
- [ ] å·²è§¦å‘é‡æ–°éƒ¨ç½²
- [ ] ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®

å®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤åï¼Œ500 é”™è¯¯åº”è¯¥ä¼šè§£å†³ã€‚

