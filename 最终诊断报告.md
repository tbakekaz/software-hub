# ğŸ” 500 é”™è¯¯æœ€ç»ˆè¯Šæ–­æŠ¥å‘Š

## ğŸ“Š å½“å‰çŠ¶æ€

æ ¹æ®ä½ çš„æˆªå›¾ï¼Œ`kazsoft.dpdns.org` ä»ç„¶æ˜¾ç¤º **500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯**ã€‚

## âœ… æœ€æ–°ä¿®å¤ï¼ˆåˆšåˆšå®Œæˆï¼‰

### å…³é”®ä¿®å¤ï¼šç§»é™¤ `lib/content.ts` ä¸­çš„ `require()`

**é—®é¢˜**ï¼š`lib/content.ts` æ–‡ä»¶åœ¨é¡¶å±‚ä½¿ç”¨äº† `require('./generated/content')`ï¼Œè¿™åœ¨ Edge Runtime ä¸­å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚

**ä¿®å¤**ï¼š
- âœ… å®Œå…¨ç§»é™¤äº†é¡¶å±‚çš„ `require()` è°ƒç”¨
- âœ… ç§»é™¤äº† `generatedContent` å˜é‡çš„åˆå§‹åŒ–
- âœ… åœ¨ Edge Runtime ä¸­ï¼Œæ‰€æœ‰å‡½æ•°ç°åœ¨ç›´æ¥è¿”å›ç©ºå€¼ï¼ˆå› ä¸ºåº”è¯¥ä½¿ç”¨ `lib/content-edge.ts`ï¼‰
- âœ… åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œç›´æ¥ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿï¼Œä¸éœ€è¦é¢„ç”Ÿæˆçš„å†…å®¹

**ä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦**ï¼š
- å³ä½¿æ–‡ä»¶åªè¢«ç”¨äºç±»å‹å¯¼å…¥ï¼ˆ`import type`ï¼‰ï¼Œæ¨¡å—çš„é¡¶å±‚ä»£ç ä»ç„¶ä¼šæ‰§è¡Œ
- `require()` åœ¨ Edge Runtime ä¸­å¯èƒ½å¤±è´¥ï¼Œå³ä½¿æœ‰ `nodejs_compat` æ ‡å¿—
- ç°åœ¨ `lib/content.ts` åœ¨ Edge Runtime ä¸­æ˜¯å®‰å…¨çš„

## âœ… å·²å®Œæˆçš„ä»£ç ä¿®å¤

### 1. æ ¸å¿ƒæ¨¡å—
- âœ… `lib/content-edge.ts` - ä½¿ç”¨é™æ€ ES6 `import`
- âœ… `lib/content.ts` - **åˆšåˆšä¿®å¤**ï¼šç§»é™¤ `require()`ï¼Œåœ¨ Edge Runtime ä¸­å®‰å…¨
- âœ… `lib/i18n/server.ts` - å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… `app/layout.tsx` - æ·»åŠ äº† `runtime = 'edge'` å’Œé”™è¯¯å¤„ç†

### 2. æ‰€æœ‰é¡µé¢
- âœ… 17 ä¸ªé¡µé¢éƒ½æœ‰ `runtime = 'edge'` å’Œé”™è¯¯å¤„ç†
- âœ… æ–°å¢æµ‹è¯•é¡µé¢ï¼š`/test` - ç”¨äºè¯Šæ–­åŸºæœ¬åŠŸèƒ½

### 3. æ‰€æœ‰ API è·¯ç”±
- âœ… 3 ä¸ª API è·¯ç”±éƒ½æœ‰é”™è¯¯å¤„ç†

### 4. é…ç½®
- âœ… `wrangler.toml` - `nodejs_compat` æ ‡å¿—
- âœ… `package.json` - Node.js 20.16.0+
- âœ… `next.config.mjs` - Edge Runtime é…ç½®

## ğŸ”§ å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šCloudflare Dashboard é…ç½®æœªç”Ÿæ•ˆ

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. è®¿é—®ï¼šhttps://dash.cloudflare.com
2. è¿›å…¥ï¼š**Workers å’Œ Pages** â†’ **software-hub** â†’ **è®¾ç½®**ï¼ˆSettingsï¼‰
3. æ£€æŸ¥ **"Functions"** éƒ¨åˆ†ï¼š
   - âœ… **ç”Ÿäº§ç¯å¢ƒ**ï¼š`nodejs_compat` å¿…é¡»å¯ç”¨
   - âœ… **é¢„è§ˆç¯å¢ƒ**ï¼š`nodejs_compat` å¿…é¡»å¯ç”¨
4. å¦‚æœæœªå¯ç”¨ï¼Œ**æ‰‹åŠ¨æ·»åŠ å¹¶ä¿å­˜**

### é—®é¢˜ 2ï¼šæ„å»ºå‘½ä»¤æœªåŒ…å« `prebuild`

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. åœ¨ Cloudflare Dashboard â†’ **è®¾ç½®** â†’ **æ„å»ºè®¾ç½®**
2. ç¡®è®¤ **æ„å»ºå‘½ä»¤** æ˜¯ï¼š
   ```bash
   npm install && npm run build && npm run pages:build
   ```
3. æ³¨æ„ï¼š`npm run build` ä¼šè‡ªåŠ¨è¿è¡Œ `prebuild`ï¼ˆå› ä¸º `package.json` ä¸­æœ‰ `"prebuild"` è„šæœ¬ï¼‰

### é—®é¢˜ 3ï¼šéƒ¨ç½²æ—¥å¿—ä¸­çš„é”™è¯¯

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. è¿›å…¥ **"éƒ¨ç½²"**ï¼ˆDeploymentsï¼‰æ ‡ç­¾
2. ç‚¹å‡»æœ€æ–°çš„éƒ¨ç½²
3. æŸ¥çœ‹ **"æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"**ï¼ˆView detailsï¼‰
4. æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯ï¼š
   - `Cannot find module './generated/content'`
   - `require is not defined`
   - `cookies() is not a function`
   - ä»»ä½•å…¶ä»–è¿è¡Œæ—¶é”™è¯¯

### é—®é¢˜ 4ï¼šNode.js ç‰ˆæœ¬ä¸åŒ¹é…

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. åœ¨ Cloudflare Dashboard â†’ **è®¾ç½®** â†’ **ç¯å¢ƒå˜é‡**
2. ç¡®è®¤ï¼š
   - `NODE_VERSION` = `20.16.0`ï¼ˆæˆ– `20`ï¼‰
   - `NODE_ENV` = `production`

## ğŸš€ ç«‹å³æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ¨é€æœ€æ–°ä¿®å¤

**é‡è¦**ï¼šåˆšåˆšä¿®å¤äº† `lib/content.ts` ä¸­çš„ `require()` é—®é¢˜ï¼Œéœ€è¦æ¨é€ä»£ç ï¼š

```bash
git add .
git commit -m "ä¿®å¤: ç§»é™¤ lib/content.ts ä¸­çš„ require()ï¼Œè§£å†³ Edge Runtime å…¼å®¹æ€§é—®é¢˜"
git push
```

### æ­¥éª¤ 2ï¼šç¡®è®¤ Cloudflare Dashboard é…ç½®

1. **å…¼å®¹æ€§æ ‡å¿—**ï¼š
   - ç”Ÿäº§ç¯å¢ƒï¼š`nodejs_compat` âœ…
   - é¢„è§ˆç¯å¢ƒï¼š`nodejs_compat` âœ…

2. **ç¯å¢ƒå˜é‡**ï¼š
   - `NODE_VERSION` = `20.16.0`
   - `NODE_ENV` = `production`

3. **æ„å»ºå‘½ä»¤**ï¼š
   ```bash
   npm install && npm run build && npm run pages:build
   ```

### æ­¥éª¤ 3ï¼šæµ‹è¯•åŸºæœ¬åŠŸèƒ½

éƒ¨ç½²å®Œæˆåï¼ŒæŒ‰é¡ºåºæµ‹è¯•ï¼š

1. **æµ‹è¯•é¡µé¢**ï¼ˆæœ€ç®€å•ï¼‰ï¼š
   - è®¿é—®ï¼š`https://kazsoft.dpdns.org/test`
   - å¦‚æœè¿™ä¸ªé¡µé¢èƒ½æ‰“å¼€ï¼Œè¯´æ˜ Edge Runtime åŸºæœ¬åŠŸèƒ½æ­£å¸¸
   - å¦‚æœè¿™ä¸ªé¡µé¢ä¹Ÿæ˜¾ç¤º 500 é”™è¯¯ï¼Œè¯´æ˜é—®é¢˜åœ¨æ›´åŸºç¡€çš„å±‚é¢

2. **é¦–é¡µ**ï¼š
   - è®¿é—®ï¼š`https://kazsoft.dpdns.org`
   - å¦‚æœæµ‹è¯•é¡µé¢èƒ½æ‰“å¼€ä½†é¦–é¡µä¸èƒ½ï¼Œè¯´æ˜é—®é¢˜åœ¨å†…å®¹åŠ è½½

### æ­¥éª¤ 4ï¼šæŸ¥çœ‹æœ€æ–°éƒ¨ç½²æ—¥å¿—

1. è¿›å…¥ **"éƒ¨ç½²"** æ ‡ç­¾
2. ç‚¹å‡»æœ€æ–°çš„éƒ¨ç½²
3. **å¤åˆ¶å®Œæ•´çš„é”™è¯¯æ—¥å¿—**ï¼ˆå¦‚æœæœ‰ï¼‰
4. ç‰¹åˆ«å…³æ³¨ï¼š
   - æ˜¯å¦æœ‰ "Cannot find module" é”™è¯¯
   - æ˜¯å¦æœ‰ "require is not defined" é”™è¯¯
   - æ˜¯å¦æœ‰ä»»ä½•è¿è¡Œæ—¶é”™è¯¯

### æ­¥éª¤ 5ï¼šæ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²ï¼ˆå¦‚æœéœ€è¦ï¼‰

1. åœ¨ **"éƒ¨ç½²"** æ ‡ç­¾
2. ç‚¹å‡» **"é‡æ–°éƒ¨ç½²"**ï¼ˆRetry deploymentï¼‰
3. ç­‰å¾… 5-10 åˆ†é’Ÿ
4. å†æ¬¡è®¿é—® `kazsoft.dpdns.org/test` å’Œ `kazsoft.dpdns.org`

## ğŸ“‹ å¦‚æœä»ç„¶å¤±è´¥

### ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šç¦ç”¨ Edge Runtimeï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰

å¦‚æœé—®é¢˜æŒç»­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸´æ—¶å°†æŸäº›é¡µé¢æ”¹ä¸º Node.js Runtime æ¥æµ‹è¯•ï¼š

1. ç§»é™¤ `export const runtime = 'edge';`ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
2. ä½¿ç”¨ Node.js Runtime
3. ç¡®è®¤é—®é¢˜æ˜¯å¦è§£å†³

**æ³¨æ„**ï¼šè¿™åªæ˜¯ä¸´æ—¶æµ‹è¯•ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯åœ¨ Edge Runtime ä¸­æ­£å¸¸è¿è¡Œã€‚

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… ä»£ç å·²ä¿®å¤å¹¶æ¨é€
2. â³ **ç­‰å¾…ä½ ç¡®è®¤ Cloudflare Dashboard é…ç½®**
3. â³ **ç­‰å¾…ä½ æä¾›éƒ¨ç½²æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯**ï¼ˆå¦‚æœæœ‰ï¼‰

è¯·å‘Šè¯‰æˆ‘ï¼š
- Cloudflare Dashboard ä¸­çš„é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
- éƒ¨ç½²æ—¥å¿—ä¸­æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯ä¿¡æ¯ï¼Ÿ

