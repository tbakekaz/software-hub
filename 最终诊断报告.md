# ğŸ” 500 é”™è¯¯æœ€ç»ˆè¯Šæ–­æŠ¥å‘Š

## ğŸ“Š å½“å‰çŠ¶æ€

æ ¹æ®ä½ çš„æˆªå›¾ï¼Œ`kazsoft.dpdns.org` ä»ç„¶æ˜¾ç¤º **500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯**ã€‚

## âœ… å·²å®Œæˆçš„ä»£ç ä¿®å¤

### 1. æ ¸å¿ƒæ¨¡å—
- âœ… `lib/content-edge.ts` - ä½¿ç”¨é™æ€ ES6 `import`
- âœ… `lib/i18n/server.ts` - å®Œæ•´çš„é”™è¯¯å¤„ç†
- âœ… `app/layout.tsx` - æ·»åŠ äº† `runtime = 'edge'` å’Œé”™è¯¯å¤„ç†

### 2. æ‰€æœ‰é¡µé¢
- âœ… 17 ä¸ªé¡µé¢éƒ½æœ‰ `runtime = 'edge'` å’Œé”™è¯¯å¤„ç†

### 3. æ‰€æœ‰ API è·¯ç”±
- âœ… 3 ä¸ª API è·¯ç”±éƒ½æœ‰é”™è¯¯å¤„ç†

### 4. é…ç½®
- âœ… `wrangler.toml` - `nodejs_compat` æ ‡å¿—
- âœ… `package.json` - Node.js 20.16.0+
- âœ… `next.config.mjs` - Edge Runtime é…ç½®

## ğŸ”§ å¯èƒ½çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šCloudflare Dashboard é…ç½®æœªç”Ÿæ•ˆ

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. è®¿é—®ï¼šhttps://dash.cloudflare.com
2. è¿›å…¥ï¼š**Workers å’Œ Pages** â†’ **software-hub** â†’ **è®¾ç½®**ï¼ˆSettingsï¼‰
3. æ£€æŸ¥ **"Functions"** éƒ¨åˆ†ï¼š
   - âœ… **ç”Ÿäº§ç¯å¢ƒ**ï¼š`nodejs_compat` å¿…é¡»å¯ç”¨
   - âœ… **é¢„è§ˆç¯å¢ƒ**ï¼š`nodejs_compat` å¿…é¡»å¯ç”¨
4. å¦‚æœæœªå¯ç”¨ï¼Œ**æ‰‹åŠ¨æ·»åŠ å¹¶ä¿å­˜**

### é—®é¢˜ 2ï¼šæ„å»ºå‘½ä»¤æœªåŒ…å« `prebuild`

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. åœ¨ Cloudflare Dashboard â†’ **è®¾ç½®** â†’ **æ„å»ºè®¾ç½®**
2. ç¡®è®¤ **æ„å»ºå‘½ä»¤** æ˜¯ï¼š
   ```bash
   npm install && npm run build && npm run pages:build
   ```
3. æ³¨æ„ï¼š`npm run build` ä¼šè‡ªåŠ¨è¿è¡Œ `prebuild`ï¼ˆå› ä¸º `package.json` ä¸­æœ‰ `"prebuild"` è„šæœ¬ï¼‰

### é—®é¢˜ 3ï¼šéƒ¨ç½²æ—¥å¿—ä¸­çš„é”™è¯¯

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. è¿›å…¥ **"éƒ¨ç½²"**ï¼ˆDeploymentsï¼‰æ ‡ç­¾
2. ç‚¹å‡»æœ€æ–°çš„éƒ¨ç½²
3. æŸ¥çœ‹ **"æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"**ï¼ˆView detailsï¼‰
4. æŸ¥æ‰¾é”™è¯¯ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯ï¼š
   - `Cannot find module './generated/content'`
   - `require is not defined`
   - `cookies() is not a function`
   - ä»»ä½•å…¶ä»–è¿è¡Œæ—¶é”™è¯¯

### é—®é¢˜ 4ï¼šNode.js ç‰ˆæœ¬ä¸åŒ¹é…

**æ£€æŸ¥æ­¥éª¤**ï¼š
1. åœ¨ Cloudflare Dashboard â†’ **è®¾ç½®** â†’ **ç¯å¢ƒå˜é‡**
2. ç¡®è®¤ï¼š
   - `NODE_VERSION` = `20.16.0`ï¼ˆæˆ– `20`ï¼‰
   - `NODE_ENV` = `production`

## ğŸš€ ç«‹å³æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤

### æ­¥éª¤ 1ï¼šç¡®è®¤ Cloudflare Dashboard é…ç½®

1. **å…¼å®¹æ€§æ ‡å¿—**ï¼š
   - ç”Ÿäº§ç¯å¢ƒï¼š`nodejs_compat` âœ…
   - é¢„è§ˆç¯å¢ƒï¼š`nodejs_compat` âœ…

2. **ç¯å¢ƒå˜é‡**ï¼š
   - `NODE_VERSION` = `20.16.0`
   - `NODE_ENV` = `production`

3. **æ„å»ºå‘½ä»¤**ï¼š
   ```bash
   npm install && npm run build && npm run pages:build
   ```

### æ­¥éª¤ 2ï¼šæŸ¥çœ‹æœ€æ–°éƒ¨ç½²æ—¥å¿—

1. è¿›å…¥ **"éƒ¨ç½²"** æ ‡ç­¾
2. ç‚¹å‡»æœ€æ–°çš„éƒ¨ç½²
3. **å¤åˆ¶å®Œæ•´çš„é”™è¯¯æ—¥å¿—**ï¼ˆå¦‚æœæœ‰ï¼‰
4. å‘é€ç»™æˆ‘ï¼Œæˆ‘å¯ä»¥å¸®ä½ åˆ†æ

### æ­¥éª¤ 3ï¼šæ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²

1. åœ¨ **"éƒ¨ç½²"** æ ‡ç­¾
2. ç‚¹å‡» **"é‡æ–°éƒ¨ç½²"**ï¼ˆRetry deploymentï¼‰
3. ç­‰å¾… 5-10 åˆ†é’Ÿ
4. å†æ¬¡è®¿é—® `kazsoft.dpdns.org`

## ğŸ“‹ å¦‚æœä»ç„¶å¤±è´¥

### ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šç¦ç”¨ Edge Runtimeï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰

å¦‚æœé—®é¢˜æŒç»­ï¼Œæˆ‘ä»¬å¯ä»¥ä¸´æ—¶å°†æŸäº›é¡µé¢æ”¹ä¸º Node.js Runtime æ¥æµ‹è¯•ï¼š

1. ç§»é™¤ `export const runtime = 'edge';`ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
2. ä½¿ç”¨ Node.js Runtime
3. ç¡®è®¤é—®é¢˜æ˜¯å¦è§£å†³

**æ³¨æ„**ï¼šè¿™åªæ˜¯ä¸´æ—¶æµ‹è¯•ï¼Œæœ€ç»ˆç›®æ ‡æ˜¯åœ¨ Edge Runtime ä¸­æ­£å¸¸è¿è¡Œã€‚

## ğŸ¯ ä¸‹ä¸€æ­¥

1. âœ… ä»£ç å·²ä¿®å¤å¹¶æ¨é€
2. â³ **ç­‰å¾…ä½ ç¡®è®¤ Cloudflare Dashboard é…ç½®**
3. â³ **ç­‰å¾…ä½ æä¾›éƒ¨ç½²æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯**ï¼ˆå¦‚æœæœ‰ï¼‰

è¯·å‘Šè¯‰æˆ‘ï¼š
- Cloudflare Dashboard ä¸­çš„é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
- éƒ¨ç½²æ—¥å¿—ä¸­æ˜¯å¦æœ‰ä»»ä½•é”™è¯¯ä¿¡æ¯ï¼Ÿ

