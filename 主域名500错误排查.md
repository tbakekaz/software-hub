# 🔍 主域名 500 错误排查指南

## 📊 当前状态

- ✅ `admin.kazsoft.dpdns.org` - **正常**（可以访问）
- ❌ `kazsoft.dpdns.org` - **500 错误**（无法访问）

这说明：
- DNS 解析正常
- 子域名 `admin` 指向了其他服务（可能是另一个应用）
- 主域名 `kazsoft.dpdns.org` 可能未正确绑定到 Cloudflare Pages，或绑定配置有问题

## 🔧 立即检查步骤

### 步骤 1：检查 Cloudflare Pages 自定义域名绑定

1. **访问 Cloudflare Dashboard**
   - 打开：https://dash.cloudflare.com
   - 登录你的账号

2. **进入 Pages 项目**
   - 左侧菜单：**Workers 和 Pages** → **software-hub**
   - 点击 **"自定义域"**（Custom domains）标签

3. **检查域名状态**
   - 查看 `kazsoft.dpdns.org` 是否在列表中
   - 如果**不在列表中**：
     - 点击 **"设置自定义域"**（Set up a custom domain）
     - 输入：`kazsoft.dpdns.org`
     - 点击 **"继续"**（Continue）
     - 按照提示配置 DNS
   - 如果**在列表中**：
     - 检查状态是否为 **"有效"**（Active）或 **"待验证"**（Pending）
     - 如果显示 **"无效"**（Invalid）或错误：
       - 点击域名右侧的 **"..."** 菜单
       - 选择 **"重新验证"**（Re-verify）或 **"删除并重新添加"**

### 步骤 2：检查 DNS 记录

1. **在 Cloudflare Dashboard 检查 DNS**
   - 左侧菜单：**网站**（Websites）→ **dpdns.org** → **DNS**
   - 查找 `kazsoft` 的记录：
     - ✅ **应该有**：`CNAME` 类型，`kazsoft` → `software-hub.pages.dev`
     - ❌ **不应该有**：`AAAA` 类型或其他类型的记录

2. **如果 DNS 记录不正确**
   - 删除所有 `kazsoft` 的记录（除了 CNAME）
   - 添加新的 CNAME 记录：
     - **类型**：`CNAME`
     - **名称**：`kazsoft`
     - **目标**：`software-hub.pages.dev`
     - **代理状态**：**橙色云朵**（已代理）或**灰色云朵**（仅 DNS）都可以

### 步骤 3：检查最新部署状态

1. **进入 "部署"（Deployments）标签**
2. **查看最新部署**
   - 点击最新的部署
   - 查看 **"查看详细信息"**（View details）
   - 检查：
     - ✅ 构建是否成功
     - ✅ 是否有任何错误或警告
     - ✅ 部署状态是否为 **"成功"**（Success）

3. **如果部署失败**
   - 查看错误日志
   - 点击 **"重新部署"**（Retry deployment）

### 步骤 4：测试 pages.dev 域名

访问：https://software-hub.pages.dev

- ✅ **如果这个可以访问**：
  - 说明部署是成功的
  - 问题在于自定义域名绑定或 DNS 配置
  - 继续检查步骤 1 和 2

- ❌ **如果这个也无法访问**：
  - 说明部署有问题
  - 需要检查构建日志和部署配置
  - 继续检查步骤 3

### 步骤 5：清除 Cloudflare 缓存

1. **在 Cloudflare Dashboard**
   - 左侧菜单：**网站**（Websites）→ **dpdns.org** → **缓存**（Caching）
   - 点击 **"清除所有内容"**（Purge Everything）
   - 等待几分钟

2. **清除浏览器缓存**
   - 按 `Ctrl+Shift+R`（Windows/Linux）或 `Cmd+Shift+R`（Mac）
   - 或使用无痕模式访问

## 🎯 可能的原因和解决方案

### 原因 1：域名未绑定到 Cloudflare Pages

**症状**：`kazsoft.dpdns.org` 不在自定义域名列表中

**解决**：
1. 在 Cloudflare Pages → **自定义域** → **设置自定义域**
2. 输入 `kazsoft.dpdns.org`
3. 按照提示配置 DNS

### 原因 2：DNS 记录类型错误

**症状**：DNS 中有 `AAAA` 记录而不是 `CNAME` 记录

**解决**：
1. 删除 `AAAA` 记录
2. 添加 `CNAME` 记录：`kazsoft` → `software-hub.pages.dev`

### 原因 3：DNS 记录指向错误

**症状**：`CNAME` 记录存在，但指向了错误的地址

**解决**：
1. 检查 `CNAME` 记录的目标是否为 `software-hub.pages.dev`
2. 如果不是，修改为正确的目标

### 原因 4：SSL 证书未配置

**症状**：域名绑定后，SSL 证书状态为 "待处理" 或 "错误"

**解决**：
1. 等待 5-15 分钟让 Cloudflare 自动配置 SSL
2. 如果仍然失败，删除域名并重新添加

### 原因 5：部署失败

**症状**：`software-hub.pages.dev` 也无法访问

**解决**：
1. 检查构建日志中的错误
2. 确认构建命令正确：`npm install && npm run build && npm run pages:build`
3. 确认 `nodejs_compat` 标志已启用
4. 重新部署

## 📋 快速检查清单

- [ ] `kazsoft.dpdns.org` 在 Cloudflare Pages 的自定义域名列表中
- [ ] 自定义域名状态为 **"有效"**（Active）
- [ ] DNS 记录类型为 `CNAME`
- [ ] DNS 记录目标为 `software-hub.pages.dev`
- [ ] 最新部署状态为 **"成功"**（Success）
- [ ] `software-hub.pages.dev` 可以正常访问
- [ ] SSL 证书状态为 **"有效"**（Active）

## 🚀 下一步

1. **立即检查**：按照步骤 1-5 逐一检查
2. **提供信息**：告诉我：
   - `kazsoft.dpdns.org` 是否在自定义域名列表中？
   - DNS 记录类型是什么？
   - `software-hub.pages.dev` 是否可以访问？
   - 最新部署的状态是什么？

根据这些信息，我可以提供更精确的解决方案。

